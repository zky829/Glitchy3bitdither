---
layout: template
---

<h1>Glitch Chooser</h1>
<p>Select an image, then apply a mutation. Each time you apply a mutation a new image is created from the input. Each time you replace a mutation the new image is replaced.</p>
<div id="form">
    <input type="file" id="uploader">
    <button id="apply">apply</button>
    <button id="replace">replace</button>
</div>
<div id="output"></div>
<script>
    var exp = ['pixelFunk', 'superPixelFunk', 'shortsort', 'shortdumbsort', 'sort', 'slicesort', 'sortStripe', 'sortRows', 'randomSortRows', 'dumbSortRows', 'pixelSort', 'randomGlitch', 'glitch', 'preset1', 'preset2', 'preset3', 'preset4'];
    var orig = ['focusImage', 'rgb_glitch', 'invert', 'slice', 'slice2', 'slice3', 'scanlines', 'fractalGhosts', 'fractalGhosts2', 'fractalGhosts3', 'fractalGhosts4', 'fractal', 'fractal2', 'DrumrollHorizontal', 'DrumrollVertical', 'DrumrollHorizontalWave', 'DrumrollVerticalWave', 'ditherBitmask', 'colorShift', 'colorShift2', 'ditherRandom', 'ditherRandom3', 'ditherBayer', 'ditherBayer3', 'redShift', 'greenShift', 'blueShift', 'superShift', 'superSlice', 'superSlice2', 'ditherAtkinsons', 'ditherFloydSteinberg', 'ditherHalftone', 'dither8Bit'];
    var picker = document.createElement("select"),
    form = document.getElementById("form"),
    functions = orig.concat(exp.concat(['theWorks','glitch','randomGlitch'])),
    functions = functions.sort(function(a, b) {
        if (a.toLowerCase() < b.toLowerCase()) return -1;
        if (a.toLowerCase() > b.toLowerCase()) return 1;
        return 0;
      }),
    img, glitcher, ctx;
    var canvas = document.createElement('canvas');

    functions.unshift('original');
    /* populate picker */
    for(var i=0, l = functions.length;i<l;i++){
        var opt = document.createElement("option");
        opt.value = functions[i];
        opt.innerHTML = functions[i];
        picker.appendChild(opt);
    }
    form.appendChild(picker);
    function place(replace){
        var tmp = document.getElementsByTagName("img");
        console.log("before: ", tmp.length, tmp);
        if(replace){ document.getElementById("output").removeChild(tmp[0]); }
        console.log("during: ", tmp.length, tmp);
        generate(picker.value);
        console.log("after: ", tmp.length, tmp);
    }
    var apply = document.getElementById('apply');
    var replace = document.getElementById('replace');
    apply.addEventListener('click', function(){place(false);});
    replace.addEventListener('click', function(){place(true);});
    replace.disabled = true;

    function handleFileSelect(e) {
        var file = e.target.files[0];
        // Only process image files.
        if (!file.type.match('image.*')) {
            return;
        }
        var reader = new FileReader();
        // Closure to capture the file information.
        reader.onload = function(e) {
            img = document.createElement("img");
            img.onload = function() {
              canvas.width = img.width;
              canvas.height = img.height;
              ctx = canvas.getContext('2d');
              ctx.drawImage(img,0,0);
              var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
              glitcher = new Gleech(imageData);
              generate("original");
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
        document.getElementById("output").innerHTML = "";
    }

    function generate(chosen){
        /* setup */
        if (document.getElementsByTagName('img').length >= 1) {
          replace.disabled = false;
        }
        console.log(chosen);
        var glitch = glitcher[chosen]().imageData;
        ctx.putImageData(glitch, 0, 0);
        var newImg = document.createElement('img');
        newImg.src = canvas.toDataURL('image/png');
        newImg.alt = chosen;
        var output = document.getElementById('output');
        console.log(output);
        output.insertBefore(newImg, output.firstChild);
        console.log(output);
    }

    document.getElementById('uploader').addEventListener('change', handleFileSelect, false);
</script>
